---
 cddl/lib/libuutil/Makefile    |    2 ++
 cddl/lib/libzfs/Makefile      |    5 ++++-
 cddl/lib/libzpool/Makefile    |    5 ++++-
 cddl/sbin/zfs/Makefile        |   11 +++++++----
 cddl/sbin/zpool/Makefile      |    9 +++++----
 cddl/usr.bin/zinject/Makefile |    7 ++++++-
 cddl/usr.bin/ztest/Makefile   |    5 ++++-
 cddl/usr.sbin/zdb/Makefile    |    7 ++++++-
 8 files changed, 38 insertions(+), 13 deletions(-)

--- a/cddl/lib/libzfs/Makefile
+++ b/cddl/lib/libzfs/Makefile
@@ -7,7 +7,10 @@
 
 LIB=	zfs
 DPADD=	${LIBUTIL}
-LDADD=	-lutil
+LDADD=	-lm -lbsd -lgeom -lnvpair -luutil
+
+LDADD+= -L${.CURDIR}/../../../cddl/lib/libnvpair \
+	-L${.CURDIR}/../../../cddl/lib/libuutil \
 
 SRCS=	deviceid.c \
 	fsshare.c \
--- a/cddl/lib/libuutil/Makefile
+++ b/cddl/lib/libuutil/Makefile
@@ -22,4 +22,6 @@
 CFLAGS+= -I${.CURDIR}/../../../cddl/compat/opensolaris/include
 CFLAGS+= -I${.CURDIR}/../../../cddl/contrib/opensolaris/head
 
+LDADD= -lrt -lbsd -lpthread
+
 .include <bsd.lib.mk>
--- a/cddl/sbin/zfs/Makefile
+++ b/cddl/sbin/zfs/Makefile
@@ -19,9 +19,12 @@
 CFLAGS+= -I${.CURDIR}/../../../sys/cddl/contrib/opensolaris/uts/common/fs/zfs
 CFLAGS+= -I${.CURDIR}/../../../sys/cddl/contrib/opensolaris/uts/common/sys
 
-DPADD=	${LIBZFS} ${LIBGEOM} ${LIBBSDXML} ${LIBSBUF} \
-	${LIBM} ${LIBNVPAIR} ${LIBUUTIL} ${LIBUTIL}
-LDADD=	-lzfs -lgeom -lbsdxml -lsbuf \
-	-lm -lnvpair -luutil -lutil
+DPADD=	${LIBZFS} ${LIBGEOM} \
+	${LIBM} ${LIBNVPAIR} ${LIBUUTIL}
+LDADD=	-lzfs -lgeom -lnvpair -luutil -lbsd
+
+LDADD+= -L${.CURDIR}/../../../cddl/lib/libzfs \
+       -L${.CURDIR}/../../../cddl/lib/libnvpair \
+       -L${.CURDIR}/../../../cddl/lib/libuutil 
 
 .include <bsd.prog.mk>
--- a/cddl/sbin/zpool/Makefile
+++ b/cddl/sbin/zpool/Makefile
@@ -21,9 +21,10 @@
 CFLAGS+= -I${.CURDIR}/../../../sys/cddl/contrib/opensolaris/uts/common/fs/zfs
 CFLAGS+= -I${.CURDIR}/../../../sys/cddl/contrib/opensolaris/uts/common/sys
 
-DPADD=	${LIBAVL} ${LIBZFS} ${LIBGEOM} ${LIBBSDXML} ${LIBSBUF} \
-	${LIBM} ${LIBNVPAIR} ${LIBUUTIL} ${LIBUTIL}
-LDADD=	-lavl -lzfs -lgeom -lbsdxml -lsbuf \
-	-lm -lnvpair -luutil -lutil
+DPADD=	${LIBZFS} ${LIBGEOM} ${LIBNVPAIR} ${LIBUUTIL}
+LDADD=	-lzfs -lgeom -lnvpair -luutil -lbsd
+LDADD+= -L${.CURDIR}/../../../cddl/lib/libzfs \
+	-L${.CURDIR}/../../../cddl/lib/libnvpair \
+	-L${.CURDIR}/../../../cddl/lib/libuutil
 
 .include <bsd.prog.mk>
--- a/cddl/usr.sbin/zdb/Makefile
+++ b/cddl/usr.sbin/zdb/Makefile
@@ -21,7 +21,12 @@
 
 DPADD=	${LIBAVL} ${LIBGEOM} ${LIBM} ${LIBNVPAIR} ${LIBPTHREAD} ${LIBUMEM} \
 	${LIBUUTIL} ${LIBZ} ${LIBZFS} ${LIBZPOOL}
-LDADD=	-lavl -lgeom -lm -lnvpair -lpthread -lumem -luutil -lz -lzfs -lzpool
+LDADD=	-lgeom -lm -lnvpair -lpthread -lumem -luutil -lz -lzfs -lzpool
+LDADD+= -L${.CURDIR}/../../../cddl/lib/libumem
+LDADD+= -L${.CURDIR}/../../../cddl/lib/libzpool
+LDADD+= -L${.CURDIR}/../../../cddl/lib/libnvpair
+LDADD+= -L${.CURDIR}/../../../cddl/lib/libuutil
+LDADD+= -L${.CURDIR}/../../../cddl/lib/libzfs
 
 CSTD=	c99
 
--- a/cddl/usr.bin/zinject/Makefile
+++ b/cddl/usr.bin/zinject/Makefile
@@ -20,6 +20,11 @@
 
 DPADD=	${LIBAVL} ${LIBGEOM} ${LIBM} ${LIBNVPAIR} ${LIBUMEM} ${LIBUUTIL} \
 	${LIBZFS} ${LIBZPOOL} ${LIBUUTIL}
-LDADD=	-lavl -lgeom -lm -lnvpair -lumem -luutil -lzfs -lzpool
+LDADD=	-lgeom -lm -lnvpair -lumem -luutil -lzfs -lzpool
+LDADD+= -L${.CURDIR}/../../../cddl/lib/libzpool
+LDADD+= -L${.CURDIR}/../../../cddl/lib/libumem
+LDADD+= -L${.CURDIR}/../../../cddl/lib/libnvpair
+LDADD+= -L${.CURDIR}/../../../cddl/lib/libuutil
+LDADD+= -L${.CURDIR}/../../../cddl/lib/libzfs
 
 .include <bsd.prog.mk>
--- a/cddl/usr.bin/ztest/Makefile
+++ b/cddl/usr.bin/ztest/Makefile
@@ -17,7 +17,10 @@
 
 DPADD=	${LIBM} ${LIBNVPAIR} ${LIBUMEM} ${LIBZPOOL} \
 	${LIBPTHREAD} ${LIBZ} ${LIBAVL}
-LDADD=	-lm -lnvpair -lumem -lzpool -lpthread -lz -lavl
+LDADD=	-lm -lnvpair -lumem -lzpool -lpthread -lz -lrt -ldl -lbsd
+LDADD+= -L${.CURDIR}/../../../cddl/lib/libzpool
+LDADD+= -L${.CURDIR}/../../../cddl/lib/libumem
+LDADD+= -L${.CURDIR}/../../../cddl/lib/libnvpair
 
 CSTD=	c99
 
--- a/cddl/lib/libzpool/Makefile
+++ b/cddl/lib/libzpool/Makefile
@@ -53,7 +53,10 @@
 CFLAGS+=	-I${.CURDIR}/../../../lib/libthr/arch/${MACHINE_ARCH}/include
 
 DPADD=		${LIBPTHREAD} ${LIBZ}
-LDADD=		-lpthread -lz
+LDADD=		-lpthread -lz -lrt -lbsd -lnvpair -lumem
+LDADD+=	-L${.CURDIR}/../../../cddl/lib/libnvpair
+LDADD+=	-L${.CURDIR}/../../../cddl/lib/libumem
+LDADD+=	${.CURDIR}/../../../cddl/lib/libavl/libavl.a
 
 # atomic.S doesn't like profiling.
 NO_PROFILE=
