diff -ur a/sys/cddl/compat/opensolaris/rpc/xdr.h b/sys/cddl/compat/opensolaris/rpc/xdr.h
--- a/sys/cddl/compat/opensolaris/rpc/xdr.h	2010-08-13 15:55:24.000000000 -0400
+++ b/sys/cddl/compat/opensolaris/rpc/xdr.h	2010-08-13 15:57:13.000000000 -0400
@@ -32,7 +32,7 @@
 
 #include_next <rpc/xdr.h>
 
-#ifndef _KERNEL
+#if !defined(_KERNEL) && defined(__FreeBSD__)
 
 #include <assert.h>
 
@@ -65,6 +65,6 @@
 	    xdrmem_control((xdrs), (req), (op)) :			\
 	    (*(xdrs)->x_ops->x_control)(xdrs, req, op))   
 
-#endif	/* !_KERNEL */
+#endif	/* !_KERNEL && __FreeBSD__ */
 
 #endif	/* !_OPENSOLARIS_RPC_XDR_H_ */
diff -ur a/sys/cddl/contrib/opensolaris/common/nvpair/nvpair.c b/sys/cddl/contrib/opensolaris/common/nvpair/nvpair.c
--- a/sys/cddl/contrib/opensolaris/common/nvpair/nvpair.c	2010-08-13 15:56:20.000000000 -0400
+++ b/sys/cddl/contrib/opensolaris/common/nvpair/nvpair.c	2010-08-13 15:56:44.000000000 -0400
@@ -3191,8 +3191,6 @@
 		return (nvs_xdr_nvp_op(nvs, nvp));
 	}
 	case NVS_OP_DECODE: {
-		struct xdr_bytesrec bytesrec;
-
 		/* get the encode and decode size */
 		if (!xdr_int(xdr, &encode_len) || !xdr_int(xdr, &decode_len))
 			return (EFAULT);
@@ -3202,12 +3200,16 @@
 		if (*size == 0)
 			return (0);
 
+#if defined(__sun) || defined(__FreeBSD__)
+		struct xdr_bytesrec bytesrec;
+
 		/* sanity check the size parameter */
 		if (!xdr_control(xdr, XDR_GET_BYTES_AVAIL, &bytesrec))
 			return (EFAULT);
 
 		if (*size > NVS_XDR_MAX_LEN(bytesrec.xc_num_avail))
 			return (EFAULT);
+#endif
 		break;
 	}
 
