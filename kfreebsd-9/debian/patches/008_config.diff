
Sent to freebsd-hackers (2011-07-02)

--- a/usr.sbin/config/main.c
+++ b/usr.sbin/config/main.c
@@ -591,7 +591,11 @@
 	if ((dirp = opendir(p)) == NULL)
 		err(EX_OSERR, "opendir %s", p);
 	while ((dp = readdir(dirp)) != NULL) {
+#ifdef _DIRENT_HAVE_D_NAMLEN
 		i = dp->d_namlen - 2;
+#else
+		i = strlen (dp->d_name) - 2;
+#endif
 		/* Skip non-headers */
 		if (dp->d_name[i] != '.' || dp->d_name[i + 1] != 'h')
 			continue;
--- a/usr.sbin/config/Makefile
+++ b/usr.sbin/config/Makefile
@@ -12,7 +12,7 @@
 CFLAGS+= -I. -I${.CURDIR}
 
 DPADD=	${LIBL} ${LIBSBUF}
-LDADD=	-ll -lsbuf
+LDADD=	-ll -lsbuf -lbsd
 
 CLEANFILES+=	kernconf.c
 
