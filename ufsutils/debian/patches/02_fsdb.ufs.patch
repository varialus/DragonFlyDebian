#DPATCHLEVEL=1
Index: uf-a/fsdb.ufs/fsdb.8
===================================================================
--- uf-a.orig/fsdb.ufs/fsdb.8	2006-09-22 13:20:10.000000000 +0200
+++ uf-a/fsdb.ufs/fsdb.8	2007-01-18 10:41:04.000000000 +0100
@@ -263,7 +263,7 @@
 .Nm
 does not implement.
 .Sh WARNING
-Use this tool with extreme caution--you can damage an FFS file system
+Use this tool with extreme caution\-\-you can damage an FFS file system
 beyond what
 .Xr fsck 8
 can repair.
Index: uf-a/fsdb.ufs/fsdb.c
===================================================================
--- uf-a.orig/fsdb.ufs/fsdb.c	2006-09-22 13:20:10.000000000 +0200
+++ uf-a/fsdb.ufs/fsdb.c	2007-01-18 11:12:31.000000000 +0100
@@ -35,13 +35,13 @@
 
 #include <sys/param.h>
 #include <sys/time.h>
+#include <time.h>
 #include <ctype.h>
 #include <err.h>
 #include <grp.h>
 #include <histedit.h>
 #include <pwd.h>
 #include <string.h>
-#include <timeconv.h>
 
 #include <ufs/ufs/dinode.h>
 #include <ufs/ufs/dir.h>
@@ -60,6 +60,18 @@
 static int find_indirblks32(uint32_t blk, int ind_level, uint32_t *blknum);
 static int find_indirblks64(uint64_t blk, int ind_level, uint64_t *blknum);
 
+static inline int32_t
+_time_to_time32(time_t t)
+{
+    return((int32_t)t);
+}
+
+static inline int64_t
+_time_to_time64(time_t t)
+{
+    return((int64_t)t);
+}    
+
 static void 
 usage(void)
 {
Index: uf-a/fsdb.ufs/fsdbutil.c
===================================================================
--- uf-a.orig/fsdb.ufs/fsdbutil.c	2006-09-22 13:20:10.000000000 +0200
+++ uf-a/fsdb.ufs/fsdbutil.c	2007-01-18 11:12:19.000000000 +0100
@@ -41,7 +41,6 @@
 #include <stdint.h>
 #include <string.h>
 #include <time.h>
-#include <timeconv.h>
 
 #include <ufs/ufs/dinode.h>
 #include <ufs/ffs/fs.h>
@@ -51,6 +50,18 @@
 #include "fsdb.h"
 #include "fsck.h"
 
+static inline time_t
+_time64_to_time(int64_t t64)
+{
+    return((time_t)t64);
+}
+    
+static inline time_t
+_time32_to_time(int32_t t32)
+{
+    return((time_t)t32);
+}
+    
 static int charsperline(void);
 static int printindir(ufs2_daddr_t blk, int level, char *bufp);
 static void printblocks(ino_t inum, union dinode *dp);
Index: uf-a/fsdb.ufs/Makefile
===================================================================
--- uf-a.orig/fsdb.ufs/Makefile	2004-10-09 17:56:34.000000000 +0200
+++ uf-a/fsdb.ufs/Makefile	2007-01-18 10:46:15.000000000 +0100
@@ -2,15 +2,13 @@
 #	@(#)Makefile	8.1 (Berkeley) 6/5/93
 # $FreeBSD: src/sbin/fsdb/Makefile,v 1.19 2004/10/09 15:56:34 le Exp $
 
-PROG=	fsdb
-MAN=	fsdb.8
-SRCS=	fsdb.c fsdbutil.c \
-	dir.c ea.c fsutil.c inode.c pass1.c pass1b.c pass2.c pass3.c pass4.c \
-	pass5.c setup.c utilities.c ffs_subr.c ffs_tables.c
-CFLAGS+= -I${.CURDIR}/../fsck_ffs
-WARNS?= 2
-LDADD=	-ledit -ltermcap
-DPADD=	${LIBEDIT} ${LIBTERMCAP}
-.PATH:	${.CURDIR}/../fsck_ffs ${.CURDIR}/../../sys/ufs/ffs
+PROG = fsdb.ufs
+MAN = fsdb.8:fsdb.ufs.8
+SRCS = fsdb.c fsdbutil.c
+WARNS = 0
+LDADD += -ledit -ltermcap -L../libufs -lufs -L../fsck.ufs -lfsck.ufs
+DPADD += ${LIBEDIT} ${LIBTERMCAP}
+INCLUDES = -I../fsck.ufs
 
-.include <bsd.prog.mk>
+include ../Makefile.common
+ 
