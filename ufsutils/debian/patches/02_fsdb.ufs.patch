---
 fsdb.ufs/Makefile   |   20 +++++++++-----------
 fsdb.ufs/fsdb.8     |    2 +-
 fsdb.ufs/fsdb.c     |   14 +++++++++++++-
 fsdb.ufs/fsdbutil.c |   13 ++++++++++++-
 4 files changed, 35 insertions(+), 14 deletions(-)

--- a/fsdb.ufs/fsdb.8
+++ b/fsdb.ufs/fsdb.8
@@ -263,7 +263,7 @@ There are a bunch of other things that y
 .Nm
 does not implement.
 .Sh WARNING
-Use this tool with extreme caution--you can damage an FFS file system
+Use this tool with extreme caution\-\-you can damage an FFS file system
 beyond what
 .Xr fsck 8
 can repair.
--- a/fsdb.ufs/fsdb.c
+++ b/fsdb.ufs/fsdb.c
@@ -35,13 +35,13 @@ static const char rcsid[] =
 
 #include <sys/param.h>
 #include <sys/time.h>
+#include <time.h>
 #include <ctype.h>
 #include <err.h>
 #include <grp.h>
 #include <histedit.h>
 #include <pwd.h>
 #include <string.h>
-#include <timeconv.h>
 
 #include <ufs/ufs/dinode.h>
 #include <ufs/ufs/dir.h>
@@ -60,6 +60,18 @@ static int find_blks64(uint64_t *buf, in
 static int find_indirblks32(uint32_t blk, int ind_level, uint32_t *blknum);
 static int find_indirblks64(uint64_t blk, int ind_level, uint64_t *blknum);
 
+static inline int32_t
+_time_to_time32(time_t t)
+{
+    return((int32_t)t);
+}
+
+static inline int64_t
+_time_to_time64(time_t t)
+{
+    return((int64_t)t);
+}    
+
 static void 
 usage(void)
 {
--- a/fsdb.ufs/fsdbutil.c
+++ b/fsdb.ufs/fsdbutil.c
@@ -41,7 +41,6 @@ static const char rcsid[] =
 #include <stdint.h>
 #include <string.h>
 #include <time.h>
-#include <timeconv.h>
 
 #include <ufs/ufs/dinode.h>
 #include <ufs/ffs/fs.h>
@@ -51,6 +50,18 @@ static const char rcsid[] =
 #include "fsdb.h"
 #include "fsck.h"
 
+static inline time_t
+_time64_to_time(int64_t t64)
+{
+    return((time_t)t64);
+}
+    
+static inline time_t
+_time32_to_time(int32_t t32)
+{
+    return((time_t)t32);
+}
+    
 static int charsperline(void);
 static int printindir(ufs2_daddr_t blk, int level, char *bufp);
 static void printblocks(ino_t inum, union dinode *dp);
--- a/fsdb.ufs/Makefile
+++ b/fsdb.ufs/Makefile
@@ -2,15 +2,13 @@
 #	@(#)Makefile	8.1 (Berkeley) 6/5/93
 # $FreeBSD: src/sbin/fsdb/Makefile,v 1.19.24.1 2010/02/10 00:26:20 kensmith Exp $
 
-PROG=	fsdb
-MAN=	fsdb.8
-SRCS=	fsdb.c fsdbutil.c \
-	dir.c ea.c fsutil.c inode.c pass1.c pass1b.c pass2.c pass3.c pass4.c \
-	pass5.c setup.c utilities.c ffs_subr.c ffs_tables.c
-CFLAGS+= -I${.CURDIR}/../fsck_ffs
-WARNS?= 2
-LDADD=	-ledit -ltermcap
-DPADD=	${LIBEDIT} ${LIBTERMCAP}
-.PATH:	${.CURDIR}/../fsck_ffs ${.CURDIR}/../../sys/ufs/ffs
+PROG = fsdb.ufs
+MAN = fsdb.8:fsdb.ufs.8
+SRCS = fsdb.c fsdbutil.c
+WARNS = 0
+LDADD += -ledit -ltermcap -L../libufs -lufs -lbsd -L../fsck.ufs -lfsck.ufs
+DPADD += ${LIBEDIT} ${LIBTERMCAP}
+INCLUDES = -I../fsck.ufs
 
-.include <bsd.prog.mk>
+include ../Makefile.common
+ 
