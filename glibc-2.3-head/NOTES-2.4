glibc 2.4/2.5 status
====================

linuxthreads are moved from trunk into ports
	http://sourceware.org/ml/libc-alpha/2005-07/msg00001.html

for short term Daniel Jacobowitz <dan@debian.org> will maintain them 
	http://sourceware.org/ml/libc-alpha/2005-07/msg00002.html


used directories and files:
---------------------------

	sysdeps/kfreebsd/
	linuxthreads/kfreebsd/
	patches/
	glibc24-cfi-sysdeps.diff
	glibc24-extra-sysdeps.diff
	glibc24-memusage_no_mremap.diff
	glibc24-ftw.diff
	glibc25-queue.h

	
test build:
-----------

* get main glibc module and linuxthreads module from snapshot or directly from CVS
	(ftp://sources.redhat.com/pub/glibc/snapshots/)

* move linuxthreads & linuxthreads_db from module linuxthreads into top dir

* try to apply patches
	of course, patches in subdir upstream are already in CVS
	failures in configure/configure.in ignore
	failure in nscd/mem.c fix manually
	failures in misc/sys/queue.h [only in 2.4.9x; queue.h is updated to another *BSD]
		overwrite misc/sys/queue.h by glibc25-queue.h from this directory

* fix malloc/memusage.c - by glibc24-memusage_no_mremap.diff
	unconditionally assumes mremap and uses MREMAP_FIXED
	it also unconditionally uses __thread :-(

* io/ftw.c uses unconditionally O_DIRECTORY :-((((((
	it have to be rewritten correctly 
	add "enum { O_DIRECTORY = 0 };" into bits/fcntl.h
	this way it will have value, but will not be #define'd
	it is used unconditionally also in testsuite :-((
	(workaround currently in glibc24-extra-sysdeps.diff)

* io/ftw.c uses unconditionally (unimplemented) *at functions
	revert to previous behaviour - by glibc24-ftw.diff
	
* enable mandatory cfi marking - by glibc24-cfi-sysdeps.diff 

* update sysdeps - by glibc24-extra-sysdeps.diff

  details of glibc24-extra-sysdeps.diff:

* add "enum { O_DIRECTORY = 0 };" into bits/fcntl.h

* define MSG_NOSIGNAL
	enable definition in kfreebsd/bits/socket.h

* many files are moved from sysdeps/generic,
	we #include<> some of them, use new location
	
* new sysdeps files (based on linux)
	kernel-posix-cpu-timers.h (empty)
	check_fds.c ("void __libc_check_standard_fds (void) {;}")

* new sysdeps files (use generic version)
	sbrk.c	(#include <misc/sbrk.c>)
	check_pf.c (#include <inet/check_pf.c>)

* changes to sysdeps
	i386/sysdep.h - drop definition of SETUP_PIC_REG(reg)
	dl-osinfo.h - add function _dl_setup_stack_chk_guard()

../src/configure --enable-add-ons=linuxthreads --with-tls --with-__thread i486-kfreebsd --prefix=...

"make check" results:
---------------------
(as of 2006-06-26)

  requires (and tests) Linux specific O_NOATIME
make[2]: *** [/build/g24/build/dirent/tst-fdopendir.o] Error 1

  kernel doesn't fill enough in siginfo_t for signal handlers
make[2]: *** [/build/g24/build/posix/tst-waitid.out] Error 1

  no similar syscall, unimplemented
make[2]: *** [/build/g24/build/io/tst-readlinkat.out] Error 1

  no similar syscall, emulation hitted by (unavoidable) race condition
make[2]: *** [/build/g24/build/misc/tst-pselect.out] Error 1

  requires SIGRTMIN
make[2]: *** [/build/g24/build/rt/tst-timer2.o] Error 1
make[2]: *** [/build/g24/build/rt/tst-mqueue5.o] Error 1
make[2]: *** [/build/g24/build/rt/tst-timer4.o] Error 1
make[2]: *** [/build/g24/build/rt/tst-timer5.o] Error 1
make[2]: *** [/build/g24/build/rt/tst-cputimer1.o] Error 1
make[2]: *** [/build/g24/build/rt/tst-cputimer2.o] Error 1
make[2]: *** [/build/g24/build/rt/tst-cputimer3.o] Error 1

  examine why, maybe due to non-rt behaviour of signals
make[2]: *** [/build/g24/build/rt/tst-aio.out] Error 1
make[2]: *** [/build/g24/build/rt/tst-aio64.out] Error 1
make[2]: *** [/build/g24/build/rt/tst-aio9.out] Error 1
make[2]: *** [/build/g24/build/rt/tst-aio10.out] Error 1

  due to unimplemented readlinkat()
make[2]: *** [/build/g24/build/debug/tst-chk1.out] Error 1
make[2]: *** [/build/g24/build/debug/tst-chk2.out] Error 1
make[2]: *** [/build/g24/build/debug/tst-chk3.out] Error 1
make[2]: *** [/build/g24/build/debug/tst-lfschk1.out] Error 1
make[2]: *** [/build/g24/build/debug/tst-lfschk2.out] Error 1
make[2]: *** [/build/g24/build/debug/tst-lfschk3.out] Error 1

  kernel problem - dynamic loader is loaded at base addr 0
  all elf tests passed
	- when executed "normally"
	- when tested under kFreeBSD 6.1 with SVN r1622
make[2]: *** [/build/g24/build/elf/neededtest.out] Error 14
make[2]: *** [/build/g24/build/elf/neededtest2.out] Error 14
make[2]: *** [/build/g24/build/elf/neededtest3.out] Error 17
make[2]: *** [/build/g24/build/elf/neededtest4.out] Error 2
make[2]: *** [/build/g24/build/elf/circleload1.out] Error 9

