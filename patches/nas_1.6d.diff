 diff -ur nas-1.6d.old/debian/rules nas-1.6d/debian/rules
 --- nas-1.6d.old/debian/rules   2004-08-04 21:02:44.000000000 +0200
 +++ nas-1.6d/debian/rules       2004-08-04 21:08:56.000000000 +0200
 @@ -6,6 +6,14 @@
  allpacs=nas-doc
  instdirs=BINDIR=/usr/bin USRLIBDIR=/usr/lib MANPATH=/usr/share/man INCDIR=/usr/include MANSUFFIX=1nas LIBMANSUFFIX=3nas FILEMANSUFFIX=5nas ETCDIR=/etc/nas
 
 +DEB_BUILD_GNU_TYPE     ?= $(shell dpkg-architecture -qDEB_BUILD_GNU_TYPE)
 +DEB_BUILD_GNU_CPU      ?= $(shell dpkg-architecture -qDEB_BUILD_GNU_CPU)
 +DEB_BUILD_GNU_SYSTEM   ?= $(shell dpkg-architecture -qDEB_BUILD_GNU_SYSTEM)
 +
 +ifneq (, $(filter $(DEB_BUILD_GNU_SYSTEM),kfreebsd-gnu knetbsd-gnu))
 +DEB_BUILD_GNU_TYPE = $(DEB_BUILD_GNU_CPU)-gnu
 +endif
 +
  build:
          # Make include symlinks
         ( cd include/audio; for file in ../../lib/audio/*.h; do ln -s $$file .; done )
 @@ -19,13 +27,16 @@
         -make clean
         find . -name Makefile -exec rm -f {} \;
         find . -name '*~' -exec rm -f {} \;
 -    # Clear up include symlinks
 +       # Clear up include symlinks
         find include -type l -exec rm -f {} \;
         rm -rf debian/tmp debian/nas debian/nas-doc debian/nas-bin
         rm -rf debian/libaudio2 debian/libaudio-dev
         rm -f build debian/files
         rm -f config/config.cache config/config.h config/config.log
         rm -f config/config.status
 +       # So so ugly, but works.
 +       echo -e "#!/bin/sh\necho $(DEB_BUILD_GNU_TYPE)" > config/config.guess
 +       chmod +x config/config.guess
 
  binary-indep:  checkroot
         $(checkdir)
 diff -ur nas-1.6d.old/clients/audio/auconvert/Imakefile nas-1.6d/clients/audio/auconvert/Imakefile
 --- nas-1.6d.old/clients/audio/auconvert/Imakefile      2000-12-13 05:22:31.000000000 +0100
 +++ nas-1.6d/clients/audio/auconvert/Imakefile  2004-08-04 20:26:53.000000000 +0200
 @@ -24,7 +24,7 @@
 
  #include "../../../config/NetAudio.tmpl"
 
 -#if defined(LinuxArchitecture) || defined(FreeBSDArchitecture)
 +#if defined(LinuxArchitecture) || defined(FreeBSDArchitecture) || defined(GNUArchitecture)
   EXTRA_DEFINES = -DHAS_MKSTEMP
  #endif
 
 diff -ur nas-1.6d.old/clients/audio/audemo/audemo.c nas-1.6d/clients/audio/audemo/audemo.c
 --- nas-1.6d.old/clients/audio/audemo/audemo.c  2004-06-20 21:06:50.000000000 +0200
 +++ nas-1.6d/clients/audio/audemo/audemo.c      2004-08-04 21:33:51.000000000 +0200
 @@ -264,7 +264,8 @@
  static int      ElementCount,
                  MonitorCount;
 
 -#if !defined(sun) && !defined(linux)           /* who else doesn't have
 +#if !defined(sun) && !defined(linux) && !defined(__GNU__) && !defined(__GLIBC__)
 +                                               /* who else doesn't have
                                                  * this? */
  #define strdup ncd_strdup                      /* To avoid conflicting with
                                                  * headers on hosts that *do*
 diff -ur nas-1.6d.old/clients/audio/auedit/Imakefile nas-1.6d/clients/audio/auedit/Imakefile
 --- nas-1.6d.old/clients/audio/auedit/Imakefile 2000-12-13 05:22:35.000000000 +0100
 +++ nas-1.6d/clients/audio/auedit/Imakefile     2004-08-04 20:27:32.000000000 +0200
 @@ -24,7 +24,7 @@
 
  #include "../../../config/NetAudio.tmpl"
 
 -#if defined(LinuxArchitecture) || defined(FreeBSDArchitecture)
 +#if defined(LinuxArchitecture) || defined(FreeBSDArchitecture) || defined(GNUArchitecture)
   EXTRA_DEFINES = -DHAS_MKSTEMP
  #endif
 
 diff -ur nas-1.6d.old/lib/audio/Imakefile nas-1.6d/lib/audio/Imakefile
 --- nas-1.6d.old/lib/audio/Imakefile    2004-08-04 21:02:44.000000000 +0200
 +++ nas-1.6d/lib/audio/Imakefile        2004-08-04 20:28:14.000000000 +0200
 @@ -146,7 +146,7 @@
 
  XAULIB =
 
 -#if defined(LinuxArchitecture)
 +#if defined(LinuxArchitecture) || defined(GNUArchitecture)
  REQUIREDLIBS = -L$(USRLIBDIR) -lXt $(XAULIB) -lm
  #endif
 
 diff -ur nas-1.6d.old/server/Imakefile nas-1.6d/server/Imakefile
 --- nas-1.6d.old/server/Imakefile       2002-07-24 03:49:33.000000000 +0200
 +++ nas-1.6d/server/Imakefile   2004-08-04 21:01:09.000000000 +0200
 @@ -91,7 +91,7 @@
  #define BuildSGIServer
  #endif
 
 -#if defined(HPArchitecture) && !defined(LinuxArchitecture)
 +#if defined(HPArchitecture) && !defined(LinuxArchitecture) && !defined(GNUArchitecture)
  #define CanBuildAuServer        YES
  ALL1 = nasd
  RCMANDIR = $(MANDIR)
 @@ -99,10 +99,10 @@
  #endif
 
 
 -#if defined(i386SVR4Architecture) || defined(__FreeBSD__) || defined(FreeBSDArchitecture) || defined(LinuxArchitecture) || defined(i386BsdArchitecture) || defined(USLArchitecture) || defined(cygwinArchitecture)
 +#if defined(i386SVR4Architecture) || defined(__FreeBSD__) || defined(FreeBSDArchitecture) || defined(LinuxArchitecture) || defined(GNUArchitecture) || defined(i386BsdArchitecture) || defined(USLArchitecture) || defined(cygwinArchitecture)
  # define CanBuildAuServer      YES
 
 -# if defined(LinuxArchitecture)
 +# if defined(LinuxArchitecture) || defined(GNUArchitecture)
      RCMANDIR = $(FILEMANDIR)
      RCMANSUFFIX = 5nas
  # else
 diff -ur nas-1.6d.old/server/dda/voxware/auvoxware.c nas-1.6d/server/dda/voxware/auvoxware.c
 --- nas-1.6d.old/server/dda/voxware/auvoxware.c 2004-06-21 01:27:10.000000000 +0200
 +++ nas-1.6d/server/dda/voxware/auvoxware.c     2004-08-04 21:36:45.000000000 +0200
 @@ -1074,7 +1074,7 @@
  }
 
 
 -#if defined(__GNUC__) && !defined(linux) && !defined(USL) && !defined(__CYGWIN__)
 +#if defined(__GNUC__) && !defined(linux) && !defined(__GNU__) && !defined(__GLIBC__) && !defined(USL) && !defined(__CYGWIN__)
  inline
  #endif
  static void monoToStereoLinearSigned16LSB(numSamples)
 @@ -1089,7 +1089,7 @@
    }
  }
 
 -#if defined(__GNUC__) && !defined(linux) && !defined(USL) && !defined(__CYGWIN__)
 +#if defined(__GNUC__) && !defined(linux) && !defined(__GNU__) && !defined(__GLIBC__) && !defined(USL) && !defined(__CYGWIN__)
  inline
  #endif
  static void monoToStereoLinearUnsigned8(numSamples)
 @@ -1150,7 +1150,7 @@
    AuUnBlockAudio(l);
  }
 
 -#if defined(__GNUC__) && !defined(linux) && !defined(USL) && !defined(__CYGWIN__)
 +#if defined(__GNUC__) && !defined(linux) && !defined(__GNU__) && !defined(__GLIBC__) && !defined(USL) && !defined(__CYGWIN__)
  inline
  #endif
  static void stereoToMonoLinearSigned16LSB(numSamples)
 @@ -1165,7 +1165,7 @@
    }
  }
 
 -#if defined(__GNUC__) && !defined(linux) && !defined(USL) && !defined(__CYWIN__)
 +#if defined(__GNUC__) && !defined(linux) && !defined(__GNU__) && !defined(__GLIBC__) && !defined(USL) && !defined(__CYWIN__)
  inline
  #endif
  static void stereoToMonoLinearUnsigned8(numSamples)
 diff -ur nas-1.6d.old/server/dda/voxware/auvoxware.h nas-1.6d/server/dda/voxware/auvoxware.h
 --- nas-1.6d.old/server/dda/voxware/auvoxware.h 2002-07-25 02:42:28.000000000 +0200
 +++ nas-1.6d/server/dda/voxware/auvoxware.h     2004-08-04 21:37:11.000000000 +0200
 @@ -75,7 +75,7 @@
  #include <signal.h>
 
  typedef int AuBlock;
 -#if defined(linux)  || defined(__CYGWIN__)
 +#if defined(linux) || defined(__GNU__) || defined(__GLIBC__) || defined(__CYGWIN__)
  #define        AuBlockAudio()          0
  #define        AuUnBlockAudio(_x)
  #else /* defined(linux)  */
 diff -ur nas-1.6d.old/server/dia/auservertype.h nas-1.6d/server/dia/auservertype.h
 --- nas-1.6d.old/server/dia/auservertype.h      2002-07-25 02:42:28.000000000 +0200
 +++ nas-1.6d/server/dia/auservertype.h  2004-08-04 21:37:55.000000000 +0200
 @@ -14,7 +14,7 @@
  # define SGI_SERVER
  #endif                                         /* sgi */
 
 -#if defined(__FreeBSD__) || defined(__NetBSD__) || defined(linux) || (defined(SVR4) && (defined(SYSV386) || defined(i386))) || defined(__CYGWIN__)
 +#if defined(__FreeBSD__) || defined(__NetBSD__) || defined(linux) || defined(__GNU__) || defined(__GLIBC__) || (defined(SVR4) && (defined(SYSV386) || defined(i386))) || defined(__CYGWIN__)
  # define VOXWARE_SERVER
  #endif                                          /* voxware */
 
 diff -ur nas-1.6d.old/server/os/Imakefile nas-1.6d/server/os/Imakefile
 --- nas-1.6d.old/server/os/Imakefile    2002-07-07 23:34:54.000000000 +0200
 +++ nas-1.6d/server/os/Imakefile        2004-08-04 20:30:18.000000000 +0200
 @@ -42,7 +42,7 @@
  #define OtherObjects iopreader.o
  #endif
 
 -#if defined(HPArchitecture) && !defined(LinuxArchitecture)
 +#if defined(HPArchitecture) && !defined(LinuxArchitecture) && !defined(GNUArchitecture)
  #define OtherSources hpsocket.c
  #define OtherObjects hpsocket.o dbm.o
  #endif
 @@ -107,7 +107,7 @@
   DEPEND_DEFINES = $(DBM_DEFINES)
         LINTLIBS = ../dix/llib-ldix.ln
 
 -#if defined(HPArchitecture) && !defined(LinuxArchitecture)
 +#if defined(HPArchitecture) && !defined(LinuxArchitecture) && !defined(GNUArchitecture)
           DBMLIB = /usr/lib/libdbm.a
      XLIBSYSVDIR = $(TOP)/lib/X/sysV
  #endif /* HPArchitecture */
 @@ -121,7 +121,7 @@
  LintLibraryTarget(os,$(SRCS))
  NormalLintTarget($(SRCS))
 
 -#if defined(HPArchitecture) && !defined(LinuxArchitecture)
 +#if defined(HPArchitecture) && !defined(LinuxArchitecture) && !defined(GNUArchitecture)
  XCOMM
  XCOMM The following kludge is necessary because dbm already has a global
  XCOMM routine named "bcopy" that is implemented in a silly way.  So, we have to
 diff -ur nas-1.6d.old/server/os/access.c nas-1.6d/server/os/access.c
 --- nas-1.6d.old/server/os/access.c     1999-07-08 02:51:49.000000000 +0200
 +++ nas-1.6d/server/os/access.c 2004-08-04 21:38:39.000000000 +0200
 @@ -75,7 +75,7 @@
  #include <netdnet/dnetdb.h>
  #endif
 
 -#if (defined(SYSV386) && defined(SVR4)) || defined(ISC) || defined(linux)
 +#if (defined(SYSV386) && defined(SVR4)) || defined(ISC) || defined(linux) || defined(__GNU__) || defined(__GLIBC__)
  #define USE_FALLBACK_DEFINESELF
  #endif
 
 @@ -244,7 +244,7 @@
   * the server always originate from remote clients.
   */
  #ifndef AMOEBA
 -#if defined(SVR4) || defined (SYSV386) || defined (linux) || (defined (hpux) && ! defined (HAS_IFREQ)) || defined(USE_FALLBACK_DEFINESELF)
 +#if defined(SVR4) || defined (SYSV386) || defined (linux) || defined(__GNU__) || defined(__GLIBC__) || (defined (hpux) && ! defined (HAS_IFREQ)) || defined(USE_FALLBACK_DEFINESELF)
  /* Define this host for access control.  Find all the hosts the OS knows about
   * for this fd and add them to the selfhosts list.
   * hpux, and some SYSV386 do not have SIOCGIFCONF ioctl;
