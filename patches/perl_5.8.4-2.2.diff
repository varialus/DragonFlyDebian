
Status: in BTS.

diff -Nur perl-5.8.4.old/debian/config.debian perl-5.8.4/debian/config.debian
--- perl-5.8.4.old/debian/config.debian	2004-05-09 16:46:58.000000000 +0200
+++ perl-5.8.4/debian/config.debian	2004-05-09 16:56:36.000000000 +0200
@@ -82,6 +82,8 @@
     -Duselargefiles				\
     -Dccflags=\'$ccflags\'			\
     -Dcccdlflags=-fPIC				\
+    -Dccdlflags='-Wl,--export-dynamic'		\
+    -Dlddlflags='-shared'			\
     -Darchname=$archname			\
     -Dprefix=/usr				\
     -Dprivlib=/usr/share/perl/$ver		\
diff -Nur perl-5.8.4.old/debian/rules perl-5.8.4/debian/rules
--- perl-5.8.4.old/debian/rules	2004-05-09 16:46:58.000000000 +0200
+++ perl-5.8.4/debian/rules	2004-05-09 16:55:43.000000000 +0200
@@ -6,6 +6,8 @@
 
 export SHELL = /bin/sh
 
+DEB_BUILD_GNU_SYSTEM ?= $(shell dpkg-architecture -qDEB_BUILD_GNU_SYSTEM)
+
 fullversion := $(shell /bin/bash debian/config.debian --full-version)
 version     := $(shell /bin/bash debian/config.debian --version)
 installtype := $(shell /bin/bash debian/config.debian --install-type)
@@ -43,7 +45,12 @@
 	rm -f libperl.so* # must be built last
 	-$(MAKE) distclean
 	$(SHELL) debian/config.debian --static
-	$(MAKE) perl $(test_target)
+	$(MAKE) perl
+ifeq ($(DEB_BUILD_GNU_SYSTEM),linux)
+	$(MAKE) $(test_target)
+else
+	-$(MAKE) $(test_target)
+endif
 	mv libperl.a libperl-static
 	mv perl perl.static
 
@@ -63,7 +70,12 @@
 	$(MAKE) SHRPLDFLAGS='$$(LDDLFLAGS) -Wl,-soname,libperl.so.$(version)' $@
 	ln -s libperl.so.$(fullversion) libperl.so.$(version)
 	ln -s libperl.so.$(version) libperl.so
-	$(MAKE) all $(test_target) || { rm -f libperl.so*; exit 1; }
+	$(MAKE) all || { rm -f libperl.so*; exit 1; }
+ifeq ($(DEB_BUILD_GNU_SYSTEM),linux)
+	$(MAKE) $(test_target) || { rm -f libperl.so*; exit 1; }
+else
+	-$(MAKE) $(test_target)
+endif
 
 clean:
 	$(checkdir)
diff -Nur perl-5.8.4.old/hints/gnukfreebsd.sh perl-5.8.4/hints/gnukfreebsd.sh
--- perl-5.8.4.old/hints/gnukfreebsd.sh	1970-01-01 01:00:00.000000000 +0100
+++ perl-5.8.4/hints/gnukfreebsd.sh	2004-05-09 16:47:30.000000000 +0200
@@ -0,0 +1,2 @@
+#!/bin/sh
+. ./hints/linux.sh
diff -Nur perl-5.8.4.old/hints/gnuknetbsd.sh perl-5.8.4/hints/gnuknetbsd.sh
--- perl-5.8.4.old/hints/gnuknetbsd.sh	1970-01-01 01:00:00.000000000 +0100
+++ perl-5.8.4/hints/gnuknetbsd.sh	2004-05-09 16:47:30.000000000 +0200
@@ -0,0 +1,2 @@
+#!/bin/sh
+. ./hints/linux.sh
