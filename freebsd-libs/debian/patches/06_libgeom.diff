---
 lib/libgeom/Makefile        |    2 +-
 lib/libgeom/geom_ctl.c      |    3 +++
 lib/libgeom/geom_stats.c    |    2 +-
 lib/libgeom/geom_util.c     |    1 +
 lib/libgeom/geom_xml2tree.c |    2 +-
 5 files changed, 7 insertions(+), 3 deletions(-)

Index: freebsd-libs/lib/libgeom/Makefile
===================================================================
--- freebsd-libs.orig/lib/libgeom/Makefile	2009-11-14 09:46:19.000000000 +0000
+++ freebsd-libs/lib/libgeom/Makefile	2009-11-14 09:46:40.000000000 +0000
@@ -14,7 +14,7 @@
 WARNS?=	3
 
 DPADD=	${LIBBSDXML} ${LIBSBUF}
-LDADD=	-lbsdxml -lsbuf
+LDADD=	-lexpat -L../libsbuf/ -lsbuf -lrt -lbsd
 
 MAN=	libgeom.3
 
Index: freebsd-libs/lib/libgeom/geom_ctl.c
===================================================================
--- freebsd-libs.orig/lib/libgeom/geom_ctl.c	2009-11-14 09:46:19.000000000 +0000
+++ freebsd-libs/lib/libgeom/geom_ctl.c	2009-11-14 09:46:40.000000000 +0000
@@ -141,7 +141,7 @@
 	struct gctl_req_arg *ap;
 
 	req->narg++;
-	req->arg = reallocf(req->arg, sizeof *ap * req->narg);
+	req->arg = realloc(req->arg, sizeof *ap * req->narg);
 	gctl_check_alloc(req, req->arg);
 	if (req->arg == NULL) {
 		req->narg = 0;
@@ -167,6 +167,9 @@
 	if (ap->name == NULL)
 		return;
 	ap->nlen = strlen(ap->name) + 1;
+#ifndef __DECONST
+#define __DECONST(type, var)	((type)(uintptr_t)(const void *)(var))
+#endif
 	ap->value = __DECONST(void *, value);
 	ap->flag = GCTL_PARAM_RD;
 	if (len >= 0)
Index: freebsd-libs/lib/libgeom/geom_stats.c
===================================================================
--- freebsd-libs.orig/lib/libgeom/geom_stats.c	2009-11-14 09:46:20.000000000 +0000
+++ freebsd-libs/lib/libgeom/geom_stats.c	2009-11-14 09:46:40.000000000 +0000
@@ -34,11 +34,11 @@
 #include <fcntl.h>
 #include <stdlib.h>
 #include <string.h>
+#include <time.h>
 #include <unistd.h>
 #include <libgeom.h>
 
 #include <sys/mman.h>
-#include <sys/time.h>
 #include <sys/types.h>
 #include <sys/devicestat.h>
 
Index: freebsd-libs/lib/libgeom/geom_xml2tree.c
===================================================================
--- freebsd-libs.orig/lib/libgeom/geom_xml2tree.c	2009-11-14 09:46:20.000000000 +0000
+++ freebsd-libs/lib/libgeom/geom_xml2tree.c	2009-11-14 09:46:40.000000000 +0000
@@ -43,7 +43,7 @@
 #include <sys/sbuf.h>
 #include <sys/sysctl.h>
 #include <err.h>
-#include <bsdxml.h>
+#include <expat.h>
 #include <libgeom.h>
 
 struct mystate {
Index: freebsd-libs/lib/libgeom/geom_util.c
===================================================================
--- freebsd-libs.orig/lib/libgeom/geom_util.c	2009-11-14 09:46:20.000000000 +0000
+++ freebsd-libs/lib/libgeom/geom_util.c	2009-11-14 09:46:40.000000000 +0000
@@ -39,6 +39,7 @@
 #include <string.h>
 #include <stdlib.h>
 #include <paths.h>
+#include <bsd/string.h>
 
 #include <libgeom.h>
 
Index: freebsd-libs/lib/libgeom/geom_getxml.c
===================================================================
--- freebsd-libs.orig/lib/libgeom/geom_getxml.c	2009-11-14 09:47:41.000000000 +0000
+++ freebsd-libs/lib/libgeom/geom_getxml.c	2009-11-14 09:47:47.000000000 +0000
@@ -56,5 +56,5 @@
 		free(p);
 		return (NULL);
 	}
-	return (reallocf(p, strlen(p) + 1));
+	return (realloc(p, strlen(p) + 1));
 }
