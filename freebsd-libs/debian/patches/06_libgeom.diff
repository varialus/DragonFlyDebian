---
 lib/libgeom/Makefile        |    3 ++-
 lib/libgeom/geom_ctl.c      |    3 +++
 lib/libgeom/geom_stats.c    |    2 +-
 lib/libgeom/geom_xml2tree.c |    2 +-
 4 files changed, 7 insertions(+), 3 deletions(-)

--- a/lib/libgeom/Makefile
+++ b/lib/libgeom/Makefile
@@ -1,6 +1,7 @@
 # $FreeBSD$
 
 LIB=	geom
+SHLIB_MAJOR= 1
 SHLIBDIR?= /lib
 SRCS+=	geom_getxml.c
 SRCS+=	geom_stats.c
@@ -14,7 +15,7 @@ CFLAGS += -I${.CURDIR}
 WARNS?=	3
 
 DPADD=	${LIBBSDXML} ${LIBSBUF}
-LDADD=	-lbsdxml -lsbuf
+LDADD=	-lexpat -L../libsbuf/ -lsbuf -lrt -lbsd
 
 MAN=	libgeom.3
 
--- a/lib/libgeom/geom_ctl.c
+++ b/lib/libgeom/geom_ctl.c
@@ -167,6 +167,9 @@ gctl_ro_param(struct gctl_req *req, cons
 	if (ap->name == NULL)
 		return;
 	ap->nlen = strlen(ap->name) + 1;
+#ifndef __DECONST
+#define __DECONST(type, var)	((type)(uintptr_t)(const void *)(var))
+#endif
 	ap->value = __DECONST(void *, value);
 	ap->flag = GCTL_PARAM_RD;
 	if (len >= 0)
--- a/lib/libgeom/geom_stats.c
+++ b/lib/libgeom/geom_stats.c
@@ -34,11 +34,11 @@
 #include <fcntl.h>
 #include <stdlib.h>
 #include <string.h>
+#include <time.h>
 #include <unistd.h>
 #include <libgeom.h>
 
 #include <sys/mman.h>
-#include <sys/time.h>
 #include <sys/types.h>
 #include <sys/devicestat.h>
 
--- a/lib/libgeom/geom_xml2tree.c
+++ b/lib/libgeom/geom_xml2tree.c
@@ -43,7 +43,7 @@
 #include <sys/sbuf.h>
 #include <sys/sysctl.h>
 #include <err.h>
-#include <bsdxml.h>
+#include <expat.h>
 #include <libgeom.h>
 
 struct mystate {
