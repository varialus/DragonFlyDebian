
  current ld provides magic symbols with names like __start_* and __stop_*
  only if they are referenced, FreeBSD kernel needs them,
  for details see http://sourceware.org/bugzilla/show_bug.cgi?id=5391


--- a/sys/conf/kern.post.mk
+++ b/sys/conf/kern.post.mk
@@ -85,7 +85,9 @@
 ${FULLKERNEL}: ${SYSTEM_DEP} vers.o
 	@rm -f ${.TARGET}
 	@echo linking ${.TARGET}
-	${SYSTEM_LD}
+	${SYSTEM_LD} -o ${.TARGET}.tmp
+	gen-ld-u-options ${.TARGET}.tmp > ${.TARGET}.lopt
+	${SYSTEM_LD} "@${.TARGET}.lopt"
 .if defined(CTFMERGE)
 	${SYSTEM_CTFMERGE}
 .endif
--- a/sys/conf/kmod.mk
+++ b/sys/conf/kmod.mk
@@ -176,7 +176,9 @@
 
 .if ${MACHINE_ARCH} != amd64
 ${FULLPROG}: ${KMOD}.kld
-	${LD} -Bshareable ${LDFLAGS} -o ${.TARGET} ${KMOD}.kld
+	gen-ld-u-options ${KMOD}.kld > ${KMOD}.lopt
+	${LD} -Bshareable -z common-page-size=8192 ${LDFLAGS} -o ${.TARGET} ${KMOD}.kld "@${KMOD}.lopt"
+	${OBJCOPY} --remove-section=.comment ${.TARGET}
 .if !defined(DEBUG_FLAGS)
 	${OBJCOPY} --strip-debug ${.TARGET}
 .endif
