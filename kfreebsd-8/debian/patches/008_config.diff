
Author: rmh
Status: gotta uncomment WARNS (see #351366), and find a portable way to add
  "-lbsd".  after this it can be sent upstream.

---
 usr.sbin/config/Makefile |    6 +++---
 usr.sbin/config/config.h |    2 +-
 usr.sbin/config/main.c   |   11 ++++++++++-
 3 files changed, 14 insertions(+), 5 deletions(-)

--- a/usr.sbin/config/config.h
+++ b/usr.sbin/config/config.h
@@ -34,7 +34,7 @@
  * Config.
  */
 #include <sys/types.h>
-#include <sys/queue.h>
+#include <bsd/sys/queue.h>
 #include <stdlib.h>
 #include <string.h>
 
--- a/usr.sbin/config/main.c
+++ b/usr.sbin/config/main.c
@@ -41,6 +41,7 @@
   "$FreeBSD$";
 #endif /* not lint */
 
+#include <stdarg.h>
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <sys/sbuf.h>
@@ -48,6 +49,10 @@
 #include <sys/mman.h>
 #include <sys/param.h>
 
+#ifndef __FreeBSD__
+#include <bsd/string.h> /* strlcpy, strlcat */
+#endif
+
 #include <assert.h>
 #include <ctype.h>
 #include <err.h>
--- a/usr.sbin/config/Makefile
+++ b/usr.sbin/config/Makefile
@@ -9,11 +9,11 @@
 kernconf.c: kernconf.tmpl
 	file2c 'char kernconfstr[] = {' ',0};' < ${.CURDIR}/kernconf.tmpl > kernconf.c
 
-WARNS?=	6
-CFLAGS+= -I. -I${.CURDIR}
+#WARNS?=	6
+CFLAGS+= -I. -I${.CURDIR} -D_GNU_SOURCE
 
 DPADD=	${LIBL} ${LIBSBUF}
-LDADD=	-ll -lsbuf
+LDADD=	-ll -lsbuf -lbsd
 
 CLEANFILES+=	kernconf.c
 
