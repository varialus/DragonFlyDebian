upstream head revision 186740

--- head/sys/gnu/fs/ext2fs/ext2_bitops.h
+++ head/sys/gnu/fs/ext2fs/ext2_bitops.h
@@ -84,7 +84,7 @@
 		mask = ~0U << (ofs & 31);
 		bit = *p | ~mask;
 		if (bit != ~0U)
-			return (ffs(~bit) + ofs - 1);
+			return (ffs(~bit) + (ofs & ~31U) - 1);
 		p++;
 		ofs = (ofs + 31U) & ~31U;
 	}
