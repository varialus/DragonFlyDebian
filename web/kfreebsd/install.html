<html>
<head>
<title>Installing Debian GNU/kFreeBSD</title>
</head>
<body text="#000000" bgcolor="#ffffff" link="#0000ff" alink="#0000ff" vlink="#880088">

<table border=0 width=100% cellpadding=4>
<tr>
<td>

<font face="verdana, arial, helvetica" size=-1>
<b>Installing Debian GNU/kFreeBSD</b>

<p><b>Introduction</b>
<p><a href="http://www.debian.org/ports/kfreebsd-gnu">Debian GNU/kFreeBSD</a> is a port of the Debian packaging system 
(dpkg, apt etc.) with the GNU C library and GNU userland, built on top of the <a href="http://www.freebsd.org">FreeBSD</a> kernel. 
<br>Oh. And there's the <a href="http://www.debian.org/ports/netbsd/">NetBSD</a> port too.

<p><b>Requirements</b>

<p><font color="red">Note:</font> Debian GNU/kFreeBSD isn't exactly a stable, polished system. The whole thing is still very alpha/beta (depending on how you look at it).
<br>If you want to take on the task of installing it, you should have a good knowledge of FreeBSD (5.x in particular) and Debian GNU/Linux (preferably the unstable branch). 
<br>The most important non-computer related requirement is probably time and patience. Set aside a day/night to get everything set up.


<p>To install GNU/kFreeBSD you'll need some spare disk space (or a spare machine with disk space). Around 1Gb should be enough room.
Add more space if you plan on building packages etc.
<br>On the hardware side, any system that FreeBSD i386 supports will be fine.

<p><b>Getting started</b>

<p>The official installation method is now the <a href="http://people.debian.org/~rmh/livecd/">live CD</a>, so download it before you do anything else.
<br>There is no longer a need to download anything but the live CD. It contains a minimal environment for bootstrapping a GNU/kFreeBSD system.
<br>This means installing FreeBSD first is no longer required, but, for now you will need a working Linux or BSD system to partition your disk.

<p>Currently, the live CD does not have support for partitioning, so you'll need to setup your partitions from a working system before installing.
<br>You can do this from a FreeBSD CD or existing installation, or with <a href="http://www.gnu.org/software/parted/parted.html">GNU Parted</a> from within Linux. 
Which software you use to do this isn't a huge deal, as long as it's capable of creating the required root and swap partitions etc.

<p><b>Installing</b>
<p>Once you've finished the partitioning, boot the live CD.
<br>Now create your root filesystem and mount it.

<p><i># mkfs.ufs -O 2 -U /dev/adXsYa</i>

<p><i># mount /dev/adXsYa /mnt</i> 

<p>X is disk, Y is partition. Example: /dev/ad0s1a. This would be the first partition on the system's first disk. <i>0</i> is the disk, <i>1</i> is the slice and <i>a</i> is the partition.

<p>Extract the base GNU/kFreeBSD tarball.

<p><i># tar -C /mnt --same-owner -xzpf /root/i386-kfreebsd-gnu.tar.gz</i>

<p>Chroot in to the extracted system.

<p><i># chroot /mnt</i>

<p>Now all the base packages need to be installed and configured. 

<p><i># /native-install</i>

<p>This might take a while on some machines, so be patient.

<p>Exit the chroot and edit /mnt/etc/fstab with nano to match your system's configuration.

<p>Now unmount everything and reboot. 

<p><i># umount /mnt/dev
<p># umount /mnt</i>

<p>When you boot in to the GNU/kFreeBSD system you'll probably see some errors about daemons, missing files etc.

<p>If you're a GRUB user, make sure you have atleast version 0.94+cvs20040511. The following configuration can now be used.

<p><i>title Debian GNU/kFreeBSD
<br>root (device)
<br>kernel /boot/loader</i>

<a name="post"></a>
<p><b>Post installation notes and bugs</b>
<p>Once you've got the base system running, you'll need to do and know a few things.

<p>You can use this configuration to get a working mouse in XFree86.
<br>First, <i>apt-get install moused</i> and edit /etc/moused.conf, then add the following to /etc/X11/XF86config-4.

<p><i>Option    "Device"   "/dev/sysmouse"
<br>Option   "Protocol"   "SysMouse"</i>

<p>If you're having trouble running X as a non-root user, the following script/hack has been used successfully.

<p><i>#!/bin/bash -e
<br>export DISPLAY=:0
<br>sudo xinit /usr/bin/sudo -u `whoami` x-window-manager -- -nolistentcp</i>

<p>When building packages make sure you have the latest autotools-dev package installed. Many packages have outdated config.* files. 
<br>See <a href="http://glibc-bsd.alioth.debian.org/kfreebsd/porting/PORTING">PORTING</a> for more information.

<p>Stopping and starting daemons is done the Debian way with /etc/init.d/foo start|stop.
<br>This isn't completely bug-free on GNU/kFreeBSD though. Stopping a daemon just doesn't work.
<br>This means you may need to manually kill a process to stop a daemon or remove its' pid file before one will start. This is a known bug.

<p>DNS resolving is broken due to a Glibc bug, so you'll have to make sure /etc/hosts contains hostnames and corresponding ip addresses for any servers you want to access.
<br>MX resolving also doesn't work, so MTA's (postfix, sendmail etc.) are borked too.

<p>That's it! Start installing packages. Don't expect everything to be perfect and non-broken though.
<br>Have fun. :)

<p><b>Support, contact etc.</b>
<p>For further help with GNU/kFreeBSD related matters, you can use the mailing lists.
<p><a href="http://lists.alioth.debian.org/mailman/listinfo/glibc-bsd-devel">glibc-bsd-devel</a> for Glibc-based port discussion.
 <br><a href="http://lists.debian.org/debian-bsd">debian-bsd</a> for general Debian GNU/*BSD related matters.
  
<p>Make sure you search the archives before you post!

<p>There is also a #gnu-kbsd IRC channel on irc.freenode.net.
 

<p>Any comments or complaints about this guide can be directed to me (Joshua Cummings) at  jrac at tsn dot cc or on Jabber at penix@jabber.org.

<p><br><font size=-2>Last modified: Sat, Sep 18 00:10 AEST 2004</font>

</td>
</tr>
</table>

</body>
</html>

