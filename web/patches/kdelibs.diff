
# Status: in BTS

diff -ur kdelibs-3.3.1.old/configure.in kdelibs-3.3.1/configure.in
--- kdelibs-3.3.1.old/configure.in	2005-01-05 01:18:18.000000000 +0100
+++ kdelibs-3.3.1/configure.in	2005-01-05 01:43:05.000000000 +0100
@@ -121,7 +121,7 @@
 AC_CHECK_RANDOM
 AC_CHECK_MKSTEMPS
 AC_CHECK_MKDTEMP
-AC_CHECK_FUNCS(strtoll socket seteuid setegid strfmon stpcpy gettimeofday)
+AC_CHECK_FUNCS(strtoll socket seteuid setegid strfmon stpcpy gettimeofday tcgetattr tcsetattr)
 
 AH_BOTTOM([
 /* provide a definition for a 32 bit entity, usable as a typedef, possibly
diff -ur kdelibs-3.3.1.old/configure.in.in kdelibs-3.3.1/configure.in.in
--- kdelibs-3.3.1.old/configure.in.in	2004-02-26 22:15:43.000000000 +0100
+++ kdelibs-3.3.1/configure.in.in	2005-01-09 23:44:31.000000000 +0100
@@ -115,7 +115,7 @@
 AC_CHECK_RANDOM
 AC_CHECK_MKSTEMPS
 AC_CHECK_MKDTEMP
-AC_CHECK_FUNCS(strtoll socket seteuid setegid strfmon stpcpy gettimeofday)
+AC_CHECK_FUNCS(strtoll socket seteuid setegid strfmon stpcpy gettimeofday tcgetattr tcsetattr)
 
 AH_BOTTOM([
 /* provide a definition for a 32 bit entity, usable as a typedef, possibly
diff -ur kdelibs-3.3.1.old/debian/control kdelibs-3.3.1/debian/control
--- kdelibs-3.3.1.old/debian/control	2005-01-05 01:18:16.000000000 +0100
+++ kdelibs-3.3.1/debian/control	2005-01-05 01:27:05.000000000 +0100
@@ -3,7 +3,7 @@
 Priority: optional
 Maintainer: Debian Qt/KDE Maintainers <debian-qt-kde@lists.debian.org>
 Uploaders: Christopher L Cheney <ccheney@debian.org>, Adeodato Sim√≥ <asp16@alu.ua.es>, Riku Voipio <riku.voipio@iki.fi>
-Build-Depends: automake1.9, debhelper (>> 4.2.0), docbook-to-man, gawk, gettext, libart-2.0-dev, libarts1-dev (>> 1.3.0), libaspell-dev, libbz2-dev, libcupsys2-dev, libdb4.2-dev, libfam-dev, libidn11-dev, libjasper-1.701-dev, libldap2-dev, libopenexr-dev (>= 1.2.1), libpam0g-dev, libpcre3-dev, libsasl2-dev, libssl-dev, libtiff4-dev, libxml2-dev, libxml2-utils, libxrender-dev, libxslt1-dev, qt3-doc, sharutils, texinfo, xlibmesa-glu-dev
+Build-Depends: automake1.9, debhelper (>> 4.2.0), docbook-to-man, gawk, gettext, libart-2.0-dev, libarts1-dev (>> 1.3.0), libaspell-dev, libbz2-dev, libcupsys2-dev, libdb4.2-dev, libfam-dev, libidn11-dev, libjasper-1.701-dev, libldap2-dev, libopenexr-dev (>= 1.2.1), libpam0g-dev, libpcre3-dev, libsasl2-dev, libssl-dev, libtiff4-dev, libxml2-dev, libxml2-utils, libxrender-dev, libxslt1-dev, qt3-doc, sharutils, texinfo, xlibmesa-glu-dev | libglu1-mesa-dev
 Build-Depends-Indep: doxygen, qt3-doc
 Standards-Version: 3.6.1
 
diff -ur kdelibs-3.3.1.old/debian/rules kdelibs-3.3.1/debian/rules
--- kdelibs-3.3.1.old/debian/rules	2004-07-27 21:37:16.000000000 +0200
+++ kdelibs-3.3.1/debian/rules	2005-01-07 19:04:07.000000000 +0100
@@ -77,7 +77,8 @@
 	../configure $(configkde) --enable-final \
 	--with-distribution="$$version (`cat /etc/debian_version`)" \
 	--enable-dnotify --enable-mitshm --with-alsa --with-ipv6-lookup=auto \
-	$(FAST_MALLOC)
+	$(FAST_MALLOC) \
+	--host=i386-gnu --build=i386-gnu
 
 	touch configure-stamp
 
diff -ur kdelibs-3.3.1.old/kdecore/kpty.cpp kdelibs-3.3.1/kdecore/kpty.cpp
--- kdelibs-3.3.1.old/kdecore/kpty.cpp	2004-02-11 00:13:34.000000000 +0100
+++ kdelibs-3.3.1/kdecore/kpty.cpp	2005-01-05 01:50:28.000000000 +0100
@@ -95,24 +95,24 @@
 # endif
 #endif
 
-#if defined (__FreeBSD__) || defined (__NetBSD__) || defined (__OpenBSD__) || defined (__bsdi__) || defined(__APPLE__)
+#if defined(HAVE_TCGETATTR)
+# define _tcgetattr(fd, ttmode) tcgetattr(fd, ttmode)
+#elif defined(TIOCGETA)
 # define _tcgetattr(fd, ttmode) ioctl(fd, TIOCGETA, (char *)ttmode)
+#elif defined(TCGETS)
+# define _tcgetattr(fd, ttmode) ioctl(fd, TCGETS, (char *)ttmode)
 #else
-# if defined(_HPUX_SOURCE) || defined(__Lynx__)
-#  define _tcgetattr(fd, ttmode) tcgetattr(fd, ttmode)
-# else
-#  define _tcgetattr(fd, ttmode) ioctl(fd, TCGETS, (char *)ttmode)
-# endif
+# error
 #endif
 
-#if defined (__FreeBSD__) || defined (__NetBSD__) || defined (__OpenBSD__) || defined (__bsdi__) || defined(__APPLE__)
+#if defined(HAVE_TCSETATTR) && defined(TCSANOW)
+# define _tcsetattr(fd, ttmode) tcsetattr(fd, TCSANOW, ttmode)
+#elif defined(TIOCSETA)
 # define _tcsetattr(fd, ttmode) ioctl(fd, TIOCSETA, (char *)ttmode)
+#elif defined(TCSETS)
+# define _tcsetattr(fd, ttmode) ioctl(fd, TCSETS, (char *)ttmode)
 #else
-# ifdef _HPUX_SOURCE
-#  define _tcsetattr(fd, ttmode) tcsetattr(fd, TCSANOW, ttmode)
-# else
-#  define _tcsetattr(fd, ttmode) ioctl(fd, TCSETS, (char *)ttmode)
-# endif
+# error
 #endif
 
 #if defined (_HPUX_SOURCE)
