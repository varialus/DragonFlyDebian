Author: aurel32
Status: ugly, libbsd has to be fixed

--- kdemultimedia-3.4.2.orig/config.h.in
+++ kdemultimedia-3.4.2/config.h.in
@@ -461,13 +461,14 @@
 #endif
 #endif
 
+#include <stddef.h>
 
 
 #if !defined(HAVE_STRLCAT_PROTO)
 #ifdef __cplusplus
 extern "C" {
 #endif
-unsigned long strlcat(char*, const char*, unsigned long);
+size_t strlcat(char*, const char*, size_t);
 #ifdef __cplusplus
 }
 #endif
@@ -479,7 +480,7 @@
 #ifdef __cplusplus
 extern "C" {
 #endif
-unsigned long strlcpy(char*, const char*, unsigned long);
+size_t strlcpy(char*, const char*, size_t);
 #ifdef __cplusplus
 }
 #endif
--- kdemultimedia-3.4.2.orig/debian/akode.install.kfreebsd-i386
+++ kdemultimedia-3.4.2/debian/akode.install.kfreebsd-i386
@@ -0,0 +1,24 @@
+debian/tmp/usr/lib/libakode.so.1
+debian/tmp/usr/lib/libakode.so.1.0.0
+debian/tmp/usr/lib/libakode_jack_sink.la
+debian/tmp/usr/lib/libakode_jack_sink.so
+debian/tmp/usr/lib/libakode_mpc_decoder.la
+debian/tmp/usr/lib/libakode_mpc_decoder.so
+debian/tmp/usr/lib/libakode_mpeg_decoder.la
+debian/tmp/usr/lib/libakode_mpeg_decoder.so
+debian/tmp/usr/lib/libakode_oss_sink.la
+debian/tmp/usr/lib/libakode_oss_sink.so
+debian/tmp/usr/lib/libakode_src_resampler.la
+debian/tmp/usr/lib/libakode_src_resampler.so
+debian/tmp/usr/lib/libakode_xiph_decoder.la
+debian/tmp/usr/lib/libakode_xiph_decoder.so
+debian/tmp/usr/lib/libarts_akode.la
+debian/tmp/usr/lib/libarts_akode.so
+debian/tmp/usr/lib/mcop/akodeMPCPlayObject.mcopclass
+debian/tmp/usr/lib/mcop/akodeMPEGPlayObject.mcopclass
+debian/tmp/usr/lib/mcop/akodePlayObject.mcopclass
+debian/tmp/usr/lib/mcop/akodeSpeexStreamPlayObject.mcopclass
+debian/tmp/usr/lib/mcop/akodeVorbisStreamPlayObject.mcopclass
+debian/tmp/usr/lib/mcop/akodeXiphPlayObject.mcopclass
+debian/tmp/usr/lib/mcop/akodearts.mcopclass
+debian/tmp/usr/lib/mcop/akodearts.mcoptype
--- kdemultimedia-3.4.2.orig/debian/patches/13_kfreebsd.patch
+++ kdemultimedia-3.4.2/debian/patches/13_kfreebsd.patch
@@ -0,0 +1,136 @@
+--- kde.orig/kscd/kscdmagic/sound.cpp	2005-09-05 02:02:29.000000000 +0200
++++ kde.patched/kscd/kscdmagic/sound.cpp	2005-09-05 02:03:33.000000000 +0200
+@@ -102,7 +102,7 @@
+ 
+   int format, stereo, fragment, fqc;
+ 
+-#ifdef __FreeBSD__
++#if defined (__FreeBSD__) || defined(__FreeBSD_kernel__)
+   attempt(device = open(dspName,O_WRONLY),"opening dsp device",true);
+   format = SOUNDFORMAT;
+   attempt(ioctl(device,SNDCTL_DSP_SETFMT,&format),"setting format",true);
+@@ -143,7 +143,7 @@
+   //Was 0x00010000 + m; 
+ 
+   attemptNoDie(ioctl(device,SNDCTL_DSP_SETFRAGMENT,&fragment),"setting fragment",true);
+-#ifndef __FreeBSD__
++#if ! defined(__FreeBSD__) && ! defined(__FreeBSD_kernel__)
+   attempt(ioctl(device,SNDCTL_DSP_SETFMT,&format),"setting format",true);
+   if (format != SOUNDFORMAT) error("setting format (2)");
+ #endif
+--- kde.orig/kscd/kscd.h	2005-09-05 02:05:31.000000000 +0200
++++ kde.patched/kscd/kscd.h	2005-09-05 02:05:45.000000000 +0200
+@@ -64,7 +64,7 @@
+ #include <sys/ustat.h>
+ #endif
+ 
+-#ifdef __FreeBSD__
++#if defined (__FreeBSD__) || defined(__FreeBSD_kernel__)
+ #include <sys/param.h>
+ #include <sys/ucred.h>
+ #include <sys/mount.h>
+--- kde.orig/kscd/libwm/include/wm_config.h	2005-09-05 08:34:47.000000000 +0200
++++ kde.patched/kscd/libwm/include/wm_config.h	2005-09-05 08:35:44.000000000 +0200
+@@ -129,9 +129,9 @@
+  ***  ******  **  **  ******  ******  **  ******  **  *  **********
+  ***  ******  **  **      **      **     ****    ***    ***********
+  ******************************************************************/
+-#if defined(__FreeBSD__) || defined(__FreeBSD)
++#if defined(__FreeBSD__) || defined(__FreeBSD) || defined(__FreeBSD_kernel__)
+ 
+-#if __FreeBSD_version >= 500100
++#if __FreeBSD_version >= 500100 || __FreeBSD_kernel_version >= 500100
+ #define DEFAULT_CD_DEVICE	"/dev/acd0"
+ #else
+ #define DEFAULT_CD_DEVICE	"/dev/acd0c"
+--- kde.orig/kscd/libwm/plat_freebsd.c	2005-09-05 08:37:39.000000000 +0200
++++ kde.patched/kscd/libwm/plat_freebsd.c	2005-09-05 08:38:55.000000000 +0200
+@@ -30,7 +30,7 @@
+  *
+  */
+ 
+-#if defined(__FreeBSD__) || defined(__FreeBSD) || defined(__NetBSD__) || defined (__NetBSD)
++#if defined(__FreeBSD__) || defined(__FreeBSD) || defined(__NetBSD__) || defined (__NetBSD) || defined(__FreeBSD_kernel__)
+ 
+ #include <errno.h>
+ #include <stdio.h>
+@@ -61,7 +61,10 @@
+ #else
+ # define LEFT_PORT 0
+ # define RIGHT_PORT 1
+-# if __FreeBSD_version < 300000
++#ifndef __FreeBSD_kernel_version
++#define __FreeBSD_kernel_version __FreeBSD_version
++#endif
++# if __FreeBSD_kernel_version < 300000
+ #  include <scsi.h>
+ # endif
+ #endif
+--- kde.orig/mpeglib/configure.in.in.orig	2005-09-05 08:42:19.000000000 +0200
++++ kde.patched/mpeglib/configure.in.in	2005-09-05 08:42:38.000000000 +0200
+@@ -211,6 +211,9 @@
+ kde_mpeglib_compiles=no
+ 
+ case "$OS_TYPE" in
++  GNU/kFreeBSD)
++    kde_mpeglib_compiles=yes
++    ;;
+   FreeBSD)
+     kde_mpeglib_compiles=yes
+     ;;
+--- kde.orig/configure.in.orig	2005-09-05 08:40:05.000000000 +0200
++++ kde.patched/configure.in	2005-09-05 08:41:28.000000000 +0200
+@@ -1923,6 +1923,9 @@
+ kde_mpeglib_compiles=no
+ 
+ case "$OS_TYPE" in
++  GNU/kFreeBSD)
++    kde_mpeglib_compiles=yes
++    ;;
+   FreeBSD)
+     kde_mpeglib_compiles=yes
+     ;;
+--- kde.orig/configure.orig	2005-09-05 08:40:08.000000000 +0200
++++ kde.patched/configure	2005-09-05 08:42:02.000000000 +0200
+@@ -42630,6 +42630,9 @@
+ kde_mpeglib_compiles=no
+ 
+ case "$OS_TYPE" in
++  GNU/kFreeBSD)
++    kde_mpeglib_compiles=yes
++    ;;
+   FreeBSD)
+     kde_mpeglib_compiles=yes
+     ;;
+--- kde.orig/configure	2005-09-05 09:35:31.000000000 +0200
++++ kde.patched/configure	2005-09-05 09:36:44.000000000 +0200
+@@ -42913,6 +42913,15 @@
+ 
+     ;;
+ 
++GNU/kFreeBSD)
++    OS_TYPE="BSD"
++
++cat >>confdefs.h <<\_ACEOF
++#define OS_BSD 1
++_ACEOF
++
++    ;;
++
+   BSD/OS)
+     OS_TYPE="BSD"
+ 
+--- kde.orig/configure.in	2005-09-05 09:35:26.000000000 +0200
++++ kde.patched/configure.in	2005-09-05 09:36:27.000000000 +0200
+@@ -1956,6 +1956,11 @@
+     AC_DEFINE(OS_Linux,1,[Define if you have linux pthread])
+     ;;
+ 
++  GNU/kFreeBSD)
++    OS_TYPE="BSD"
++    AC_DEFINE(OS_BSD,1,[Define if you have BSD pthread])
++    ;;
++
+   FreeBSD)
+     OS_TYPE="BSD"
+     AC_DEFINE(OS_BSD,1,[Define if you have BSD pthread])
