
Status: dirty

diff -Nur libsdl1.2-1.2.7.old/debian/patches/013_kbsd-gnu.diff libsdl1.2-1.2.7/debian/patches/013_kbsd-gnu.diff
--- libsdl1.2-1.2.7.old/debian/patches/013_kbsd-gnu.diff	1970-01-01 01:00:00.000000000 +0100
+++ libsdl1.2-1.2.7/debian/patches/013_kbsd-gnu.diff	2004-09-19 13:46:46.000000000 +0200
@@ -0,0 +1,90 @@
+diff -ur SDL-1.2.7.old/src/joystick/bsd/SDL_sysjoystick.c SDL-1.2.7/src/joystick/bsd/SDL_sysjoystick.c
+--- SDL-1.2.7.old/src/joystick/bsd/SDL_sysjoystick.c	2004-02-18 18:22:01.000000000 +0100
++++ SDL-1.2.7/src/joystick/bsd/SDL_sysjoystick.c	2004-09-19 13:21:24.000000000 +0200
+@@ -55,12 +55,22 @@
+ #include <libusbhid.h>
+ #endif
+ 
+-#ifdef __FreeBSD__
++#if defined(__FreeBSD__) && !defined(__FreeBSD_kernel__)
++#define __FreeBSD_kernel__
++#endif
++#if defined(__NetBSD__) && !defined(__NetBSD_kernel__)
++#define __NetBSD_kernel__
++#endif
++
++#if defined(__FreeBSD_kernel__)
+ #include <osreldate.h>
+ #include <sys/joystick.h>
++#ifndef __FreeBSD_kernel_version
++#define __FreeBSD_kernel_version __FreeBSD_version
++#endif
+ #endif
+ 
+-#if defined(__NetBSD__) || defined(__OpenBSD__)
++#if defined(__NetBSD_kernel__) || defined(__OpenBSD__)
+ #include <machine/joystick.h>
+ #endif
+ 
+@@ -289,7 +299,7 @@
+ 		goto usberr;
+ 	}
+ 
+-#if defined(USBHID_NEW) || (defined(__FreeBSD__) && __FreeBSD_version >= 500111)
++#if defined(USBHID_NEW) || (defined(__FreeBSD_kernel__) && __FreeBSD_kernel_version >= 500111)
+ 	hdata = hid_start_parse(hw->repdesc, 1 << hid_input, rep->rid);
+ #else
+ 	hdata = hid_start_parse(hw->repdesc, 1 << hid_input);
+@@ -369,7 +379,7 @@
+ 	int nbutton, naxe = -1;
+ 	Sint32 v;
+ 
+-#if defined(__FreeBSD__) || defined(__NetBSD__) || defined(__OpenBSD__)
++#if defined(__FreeBSD_kernel__) || defined(__NetBSD_kernel__) || defined(__OpenBSD__)
+ 	struct joystick gameport;
+ 	static int x, y, xmin = 0xffff, ymin = 0xffff, xmax = 0, ymax = 0;
+  
+@@ -418,14 +428,14 @@
+ 		}
+ 		return;
+ 	}
+-#endif /* defined(__FreeBSD__) || defined(__NetBSD__) || defined(__OpenBSD__) */
++#endif /* defined(__FreeBSD_kernel__) || defined(__NetBSD_kernel__) || defined(__OpenBSD__) */
+ 	
+ 	rep = &joy->hwdata->inreport;
+ 
+ 	if (read(joy->hwdata->fd, REP_BUF_DATA(rep), rep->size) != rep->size) {
+ 		return;
+ 	}
+-#if defined(USBHID_NEW) || (defined(__FreeBSD__) && __FreeBSD_version >= 500111)
++#if defined(USBHID_NEW) || (defined(__FreeBSD_kernel__) && __FreeBSD_kernel_version >= 500111)
+ 	hdata = hid_start_parse(joy->hwdata->repdesc, 1 << hid_input, rep->rid);
+ #else
+ 	hdata = hid_start_parse(joy->hwdata->repdesc, 1 << hid_input);
+@@ -517,9 +527,9 @@
+ {
+ 	int len;
+ 
+-#ifdef __FreeBSD__
+-# if (__FreeBSD_version >= 460000)
+-#  if (__FreeBSD_version <= 500111)
++#ifdef __FreeBSD_kernel__
++# if (__FreeBSD_kernel_version >= 460000)
++#  if (__FreeBSD_kernel_version <= 500111)
+ 	len = hid_report_size(rd, r->rid, repinfo[repind].kind);
+ #  else
+ 	len = hid_report_size(rd, repinfo[repind].kind, r->rid);
+Only in SDL-1.2.7/src/joystick/bsd: SDL_sysjoystick.c~
+--- SDL-1.2.7.old/configure	2004-02-22 22:32:33.000000000 +0100
++++ SDL-1.2.7/configure	2004-09-19 13:46:30.000000000 +0200
+@@ -28750,8 +28750,8 @@
+               JOYSTICK_DRIVERS="$JOYSTICK_DRIVERS dummy/libjoystick_dummy.la"
+ 	    ;;
+ 	    k*bsd-gnu)
+-              JOYSTICK_SUBDIRS="$JOYSTICK_SUBDIRS bsd"
+-              JOYSTICK_DRIVERS="$JOYSTICK_DRIVERS bsd/libjoystick_bsd.la"
++              JOYSTICK_SUBDIRS="$JOYSTICK_SUBDIRS dummy"
++              JOYSTICK_DRIVERS="$JOYSTICK_DRIVERS dummy/libjoystick_dummy.la"
+ 	    ;;
+ 	  esac
+         fi
