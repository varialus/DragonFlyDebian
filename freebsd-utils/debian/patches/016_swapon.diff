
Get rid of getbsize.  Default in upstream is 512, but we might want to have
something sane instead...

---
 sbin/swapon/swapon.c |   13 ++++++++++---
 1 file changed, 10 insertions(+), 3 deletions(-)

Index: freebsd-utils/sbin/swapon/swapon.c
===================================================================
--- freebsd-utils.orig/sbin/swapon/swapon.c	2009-11-14 13:35:38.000000000 +0000
+++ freebsd-utils/sbin/swapon/swapon.c	2009-11-14 13:40:51.000000000 +0000
@@ -41,6 +41,7 @@
 #include <sys/cdefs.h>
 __FBSDID("$FreeBSD$");
 
+#include <sys/swap.h>
 #include <sys/stat.h>
 #include <sys/param.h>
 #include <sys/sysctl.h>
@@ -51,7 +52,9 @@
 #include <fstab.h>
 #include <stdio.h>
 #include <stdlib.h>
+#include <bsd/stdlib.h>
 #include <string.h>
+#include <bsd/string.h>
 #include <unistd.h>
 #include <fcntl.h>
 #include <libutil.h>
@@ -71,6 +74,8 @@
 	int ch, doall;
 	int sflag = 0, lflag = 0, hflag = 0, qflag = 0;
 
+	setprogname (argv[0]);
+
 	if ((ptr = strrchr(argv[0], '/')) == NULL)
 		ptr = argv[0];
 	if (strstr(ptr, "swapon"))
@@ -80,7 +85,7 @@
 	orig_prog = which_prog;
 	
 	doall = 0;
-	while ((ch = getopt(argc, argv, "AadghklmqsU")) != -1) {
+	while ((ch = getopt(argc, argv, "AadghklmqsUve")) != -1) {
 		switch(ch) {
 		case 'A':
 			if (which_prog == SWAPCTL) {
@@ -132,6 +137,9 @@
 				usage();
 			}
 			break;
+		case 'v':
+		case 'e':
+			break;
 		case '?':
 		default:
 			usage();
@@ -271,7 +279,8 @@
 	    hlen = 10;
 	    break;
 	default:
-	    getbsize(&hlen, &blocksize);
+	    blocksize = 1024 * 1024;
+	    hlen = 10;
 	    snprintf(buf, sizeof(buf), "%ld-blocks", blocksize);
 	    break;
 	}
Index: freebsd-utils/sbin/swapon/Makefile
===================================================================
--- freebsd-utils.orig/sbin/swapon/Makefile	2009-11-14 13:35:38.000000000 +0000
+++ freebsd-utils/sbin/swapon/Makefile	2009-11-14 13:36:03.000000000 +0000
@@ -9,6 +9,6 @@
 MLINKS+=swapon.8 swapctl.8
 
 DPADD=	${LIBUTIL}
-LDADD=	-lutil
+LDADD=	-lbsd -lutil
 
 .include <bsd.prog.mk>
